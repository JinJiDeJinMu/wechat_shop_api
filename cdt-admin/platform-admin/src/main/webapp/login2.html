<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>综合管理后台</title>
    <script src="js/babel.min.js"></script>
    <!-- 引入样式 -->
    <script src="statics/elementui/index.js"></script>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="statics/elementui/index.css"/>
</head>
<body>
    <div>
        <el-card class="login-form-layout">
            <el-form
                    autoComplete="on"
                    :model="loginForm"
                    :rules="loginRules"
                    ref="loginForm"
                    label-position="left"
            >
                <div style="text-align: center">
                    <svg-icon
                            icon-class="login-mall"
                            style="width: 56px;height: 56px;color: #409EFF"
                    ></svg-icon>
                </div>
                <h2 class="login-title color-main">未名严选</h2>
                <el-form-item prop="username">
                    <el-input
                            name="username"
                            type="text"
                            v-model="username"
                            autoComplete="on"
                            placeholder="请输入用户名"
                    >
            <span slot="prefix">
              <svg-icon icon-class="user" class="color-main"></svg-icon>
            </span>
                    </el-input>
                </el-form-item>
                <el-form-item prop="password">
                    <el-input
                            name="password"
                            :type="pwdType"
                            @keyup.enter.native="login"
                            v-model="password"
                            autoComplete="on"
                            placeholder="请输入密码"
                    >
            <span slot="prefix">
              <svg-icon icon-class="password" class="color-main"></svg-icon>
            </span>
                        <span slot="suffix" @click="showPwd">
              <svg-icon icon-class="eye" class="color-main"></svg-icon>
            </span>
                    </el-input>
                </el-form-item>
                <el-form-item label="" prop="captcha_code">
                    <el-input
                            v-model="captcha"
                            placeholder="验证码"
                            prefix-icon="lj-icon-yanzhengma"
                            autocomplete="off"
                            autocapitalize="off"
                            spellcheck="false"
                            maxlength="4"
                            @keyup.enter.native="login"
                            style="float: left; width: 122px;"
                    ></el-input>
                    <div class="captcha_code">
                        <img :src="src" @click="refreshCode" width="150px" height="40px" alt="如果看不清楚，请单击图片刷新！" title="点击刷新"/>
                    </div>
                </el-form-item>
                <el-form-item style="margin-bottom: 60px;text-align: center">
                    <el-button
                            style="width: 45%"
                            type="primary"
                            :loading="loading"
                            @click.native.prevent="login"
                    >
                        登录
                    </el-button>
                </el-form-item>
            </el-form>
        </el-card>
        <img :src="login_center_bg" class="login-center-layout" />
    </div>

    <script src="statics/libs/vue.min.js"></script>
    <script src="statics/libs/iview.min.js"></script>
    <script type="text/javascript">
        var vm = new Vue({
            el: '#loginBox',
            data: {
                username: 'admin',
                password: 'admin',
                captcha: '',
                src: 'captcha.jpg',
                loading: false,
            },
            beforeCreate: function () {
                if (self != top) {
                    top.location.href = self.location.href;
                }
            },
            methods: {
                refreshCode: function () {
                    this.src = "captcha.jpg?t=" + $.now();
                },
                login: function (event) {
                    if (vm.username == '') {
                        iview.Message.warning("用户名为空");
                        return false;
                    }
                    if (vm.password == '') {
                        iview.Message.warning("密码为空");
                        return false;
                    }
                    if (vm.captcha == '') {
                        iview.Message.warning("验证码为空");
                        return false;
                    }
                    this.loading = true;
                    var data = "username=" + vm.username + "&password=" + vm.password + "&captcha=" + vm.captcha;
                    $.ajax({
                        type: "POST",
                        url: "sys/login",
                        data: data,
                        dataType: "json",
                        success: function (result) {
                            if (result.code == 0) {//登录成功
                                parent.location.href = 'index.html';
                            } else {
                                vm.refreshCode();
                                this.loading = true;
                                iview.Message.error(result.msg);
                            }
                        }
                    });
                }
            },
            created: function () {

            }
        });
    </script>

<style scoped>
    .login-form-layout {
        position: absolute;
        left: 0;
        right: 0;
        width: 360px;
        margin: 140px auto;
        border-top: 10px solid #409eff;
    }

    .login-title {
        text-align: center;
    }

    .login-center-layout {
        background: #409eff;
        width: auto;
        height: auto;
        max-width: 100%;
        max-height: 100%;
        margin-top: 200px;
    }
</style>

</body>
</html>